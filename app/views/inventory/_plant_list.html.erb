<div data-controller="bulk-select" class="space-y-3">
  <div data-bulk-select-target="toolbar" class="hidden items-center gap-3 px-4 py-2 bg-amber-50 border border-amber-200 rounded-lg text-sm print:hidden">
    <span><strong data-bulk-select-target="count">0</strong> selected</span>
    <button type="submit" form="inventory-bulk-form"
      class="inline-flex items-center gap-1 px-3 py-1.5 bg-amber-600 text-white text-sm font-medium rounded-md hover:bg-amber-700 transition-colors"
      data-turbo-confirm="Mark all active purchases for selected plants as used up?">Mark Selected as Used Up</button>
  </div>

  <%= form_with url: bulk_mark_used_up_inventory_path, method: :patch, id: "inventory-bulk-form", class: "hidden" do %><% end %>

  <div class="bg-white rounded-lg border border-gray-200 overflow-hidden">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-50">
        <tr>
          <th class="px-4 py-3 text-left print:hidden">
            <input type="checkbox" data-bulk-select-target="selectAll" data-action="change->bulk-select#toggleAll"
              class="rounded border-gray-300 text-green-600 focus:ring-green-500">
          </th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Variety</th>
          <% unless hide_category %>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th>
          <% end %>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Viability</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Active Purchases</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-200">
        <% plants.each do |plant| %>
          <% has_active = plant.active_purchases.any? %>
          <tr class="hover:bg-gray-50">
            <td class="px-4 py-4 print:hidden">
              <% if has_active %>
                <input type="checkbox" name="plant_ids[]" value="<%= plant.id %>"
                  data-bulk-select-target="checkbox" data-action="change->bulk-select#updateCount"
                  form="inventory-bulk-form"
                  class="rounded border-gray-300 text-green-600 focus:ring-green-500">
              <% end %>
            </td>
            <td class="px-6 py-4 text-sm">
              <div class="font-medium text-gray-900">
                <%= link_to plant.name, inventory_path_for_plant(plant), class: "text-green-700 hover:text-green-900 hover:underline", data: { turbo_frame: "_top" } %>
                <% if plant.heirloom? %>
                  <span class="inline-flex items-center ml-1.5 px-2 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800">Heirloom</span>
                <% end %>
              </div>
              <% if plant.latin_name.present? %>
                <div class="text-gray-500 italic text-xs mt-0.5"><%= plant.latin_name %></div>
              <% end %>
            </td>
            <% unless hide_category %>
              <td class="px-6 py-4 text-sm text-gray-500">
                <%= plant.plant_category.name %>
                <% if plant.plant_subcategory.present? %>
                  <span class="text-gray-400">&rsaquo;</span> <%= plant.plant_subcategory.name %>
                <% end %>
              </td>
            <% end %>
            <td class="px-6 py-4 text-sm">
              <% status = plant.best_viability_status %>
              <% if status %>
                <%= render ViabilityBadgeComponent.new(status: status) %>
              <% else %>
                <span class="text-xs text-gray-400">No purchases</span>
              <% end %>
            </td>
            <td class="px-6 py-4 text-sm text-gray-500">
              <%= plant.active_purchases.size %>
            </td>
          </tr>
        <% end %>
        <% if plants.empty? %>
          <tr>
            <td colspan="<%= hide_category ? 4 : 5 %>" class="px-6 py-8 text-center text-sm text-gray-500">
              No plants found in this section.
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>
